<!--
  Scient E-Library Validator - Vercel-ready static deploy
  Place this file as /index.html in your project root.

  Also create vercel.json in the project root with the following content:
  {
    "rewrites": [ { "source": "/(.*)", "destination": "/index.html" } ]
  }

  Deployment steps:
  1) npm i -g vercel
  2) vercel login
  3) vercel --prod
  4) When prompted, confirm project name (e.g. scient-e-library-validator) and deploy.

  Notes:
  - The page uses MSG91 Verify Widget (dynamic load) and will work on Vercel domain (not localhost).
  - Replace widgetId and tokenAuth before deploy if you rotate credentials.
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Scient E-Library — Phone OTP Validator</title>

<style>
:root{font-family:Inter,system-ui}
body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:#f4f6fb}
.card{width:360px;background:#fff;border-radius:12px;padding:22px;box-shadow:0 8px 24px rgba(20,30,60,0.08)}
h1{font-size:18px;margin:0 0 14px}
label{display:block;font-size:12px;color:#374151;margin-bottom:6px}
input{width:100%;padding:10px;border:1px solid #e6e9ef;border-radius:8px}
.row{margin-top:12px}
.btn{padding:10px 14px;border-radius:8px;border:0;background:#0b5fff;color:#fff;font-weight:600;cursor:pointer}
.backBtn{padding:10px 14px;border-radius:8px;border:0;background:#e5e7eb;color:#111;font-weight:600;cursor:pointer;margin-left:8px}
.hidden{display:none}

/* Loading animation */
.loader {
  width: 35px;
  height: 35px;
  border: 4px solid #ccc;
  border-top-color: #0b5fff;
  border-radius: 50%;
  animation: spin 0.7s linear infinite;
  margin: 20px auto;
}
@keyframes spin { to { transform: rotate(360deg); } }
</style>

</head>

<body>

<div class="card">
  <h1>Phone Verification — Scient E-Library</h1>

  <!-- Phone Input Stage -->
  <div id="stage-phone">
    <label>Phone Number</label>
    <input id="phone" type="tel" placeholder="+91..." />
    <div class="row">
      <button id="sendBtn" class="btn">Send OTP</button>
    </div>
  </div>

  <!-- OTP Stage -->
  <div id="stage-otp" class="hidden">
    <div class="row">
      <button id="backBtn" class="backBtn">Back</button>
    </div>
    <div id="otp-box"></div>
  </div>

  <!-- Loading Stage -->
  <div id="stage-loading" class="hidden">
    <div class="loader"></div>
    <p style="text-align:center;font-size:14px">Verifying… Redirecting…</p>
  </div>
</div>

<script>
var configuration = {
  widgetId: "356c626d6c49333734313830",
  tokenAuth: "480876T02pkv0xEu692ee67aP1",
  exposeMethods: true,
  captchaRenderId: "otp-box",
  identifier: "",

  success: (data) => {
    console.log("OTP Verified:", data);

    document.getElementById("stage-otp").classList.add("hidden");
    document.getElementById("stage-loading").classList.remove("hidden");

    setTimeout(() => {
      window.location.href = "https://scient-e-library.vercel.app/";
    }, 1500);
  },

  failure: (error) => {
    console.log("OTP Error:", error);
    alert("OTP verification failed. Please try again.");
  }
};

// Single-init guard
var widgetLoaded = false;

function loadAndInitWidget(){
  if(widgetLoaded) return;
  widgetLoaded = true;

  const s = document.createElement("script");
  s.src = "https://verify.msg91.com/otp-provider.js";
  s.onload = () => {
    try{ initSendOTP(configuration); }catch(e){ console.error(e); }
  };
  document.body.appendChild(s);
}

document.getElementById("sendBtn").onclick = () => {
  const phone = document.getElementById("phone").value.trim();
  if (!phone) { 
    alert("Enter valid phone number.");
    return;
  }

  configuration.identifier = phone;

  document.getElementById("stage-phone").classList.add("hidden");
  document.getElementById("stage-otp").classList.remove("hidden");

  // ---- hCaptcha Reset Patch ----
  if (window.hcaptcha && window.hcaptcha.rendered) {
      try { window.hcaptcha.reset(); } catch(e){}
  }

  loadAndInitWidget();
};

document.getElementById("backBtn").onclick = () => {
  document.getElementById("stage-otp").classList.add("hidden");
  document.getElementById("stage-phone").classList.remove("hidden");
  document.getElementById("otp-box").innerHTML = ""; // clear widget container
  widgetLoaded = false;
};
</script>

</body>
</html>
